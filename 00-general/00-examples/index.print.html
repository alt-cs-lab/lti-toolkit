<!DOCTYPE html>

<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="print">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.148.1">
    <meta name="generator" content="Relearn 8.0.0">
    <meta name="description" content="LTI Toolkit Example Project Documentation
LTI Provider LTI Consumer">
    <meta name="author" content="K-State ALT&#43;CS Lab">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://alt.cs.ksu.edu/lti-toolkit/images/hero.png">
    <meta name="twitter:title" content="Examples :: LTI Toolkit">
    <meta name="twitter:description" content="LTI Toolkit Example Project Documentation
LTI Provider LTI Consumer">
    <meta property="og:url" content="https://alt.cs.ksu.edu/lti-toolkit/00-general/00-examples/index.html">
    <meta property="og:site_name" content="LTI Toolkit">
    <meta property="og:title" content="Examples :: LTI Toolkit">
    <meta property="og:description" content="LTI Toolkit Example Project Documentation
LTI Provider LTI Consumer">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://alt.cs.ksu.edu/lti-toolkit/images/hero.png">
    <meta itemprop="name" content="Examples :: LTI Toolkit">
    <meta itemprop="description" content="LTI Toolkit Example Project Documentation
LTI Provider LTI Consumer">
    <meta itemprop="dateModified" content="2026-01-19T19:46:41+00:00">
    <meta itemprop="wordCount" content="9">
    <meta itemprop="image" content="https://alt.cs.ksu.edu/lti-toolkit/images/hero.png">
    <title>Examples :: LTI Toolkit</title>
    <link href="https://alt.cs.ksu.edu/lti-toolkit/00-general/00-examples/index.html" rel="canonical" type="text/html" title="Examples :: LTI Toolkit">
    <link href="/lti-toolkit/00-general/00-examples/index.xml" rel="alternate" type="application/rss+xml" title="Examples :: LTI Toolkit">
    <link href="/lti-toolkit/00-general/00-examples/tele.html" rel="alternate" type="text/html" title="Examples :: LTI Toolkit">
    <link href="/lti-toolkit/00-general/00-examples/embed.html" rel="alternate" type="text/html" title="Examples :: LTI Toolkit">
    <link href="/lti-toolkit/css/auto-complete/auto-complete.min.css?1770144754" rel="stylesheet">
    <script src="/lti-toolkit/js/auto-complete/auto-complete.min.js?1770144754" defer></script>
    <script src="/lti-toolkit/js/search-lunr.min.js?1770144754" defer></script>
    <script src="/lti-toolkit/js/search.min.js?1770144754" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/lti-toolkit/searchindex.en.js?1770144754";
    </script>
    <script src="/lti-toolkit/js/lunr/lunr.min.js?1770144754" defer></script>
    <script src="/lti-toolkit/js/lunr/lunr.stemmer.support.min.js?1770144754" defer></script>
    <script src="/lti-toolkit/js/lunr/lunr.multi.min.js?1770144754" defer></script>
    <script src="/lti-toolkit/js/lunr/lunr.en.min.js?1770144754" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/lti-toolkit/fonts/fontawesome/css/fontawesome-all.min.css?1770144754" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/lti-toolkit/fonts/fontawesome/css/fontawesome-all.min.css?1770144754" rel="stylesheet"></noscript>
    <link href="/lti-toolkit/css/perfect-scrollbar/perfect-scrollbar.min.css?1770144754" rel="stylesheet">
    <link href="/lti-toolkit/css/theme.min.css?1770144754" rel="stylesheet">
    <link href="/lti-toolkit/css/format-print.min.css?1770144754" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = `.min`;
      window.relearn.path='\/00-general\/00-examples\/index.html';
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='https:\/\/alt.cs.ksu.edu\/lti-toolkit';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=true;
      window.relearn.enableBlockCodeWrap=false;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'light-theme' ];
      window.relearn.customvariantname = "my-custom-variant";
      // [x] russfeld
      window.relearn.writeVariant=false;
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          
          if (window.relearn.writeVariant) {
            window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
          }
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
    <link href="/lti-toolkit/css/custom.css?1770144754" rel="stylesheet">
  </head>
  <body class="mobile-support embed print" data-url="/lti-toolkit/00-general/00-examples/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      
      
      
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable 00-general" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="examples">Examples</h1>

<p>LTI Toolkit Example Project Documentation</p>
<ul class="children children-li children-sort-">
  <li class="children-title"><a href="/lti-toolkit/00-general/00-examples/provider/index.html">LTI Provider</a></li>
  <li class="children-title"><a href="/lti-toolkit/00-general/00-examples/consumer/index.html">LTI Consumer</a></li>
</ul>

  <footer class="footline">
  </footer>
</article>
          <section>
            <h1 class="a11y-only">Subsections of Examples</h1>
<article class="default">
  <header class="headline">
  </header>

<h1 id="lti-provider">LTI Provider</h1>

<p>A fully-featured LTI Tool Provider example can be found in <code>/examples/provider</code>. This document will walk through the details of how that application works.</p>
<h2 id="environment">Environment</h2>
<p>The application expects the following environment variables (typically loaded from <code>.env</code>):</p>
<div class="tab-panel" data-tab-group="16cd2f02b763ba637b49453a5653367b">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="env"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('16cd2f02b763ba637b49453a5653367b','env')"
    >
      <span class="tab-nav-text">.env</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="env"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-env" data-lang="env"><span style="display:flex;"><span><span style="color:#75715e"># Express Session Secret</span>
</span></span><span style="display:flex;"><span>SESSION_SECRET<span style="color:#f92672">=</span>your_session_secret
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Log Level</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># One of error warn info http verbose lti debug sql silly</span>
</span></span><span style="display:flex;"><span>LOG_LEVEL<span style="color:#f92672">=</span>lti
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Application Domain Name</span>
</span></span><span style="display:flex;"><span>DOMAIN_NAME<span style="color:#f92672">=</span>https://ltidemo.home.russfeld.me
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># LTI Consumer Key and Secret</span>
</span></span><span style="display:flex;"><span>LTI_CONSUMER_KEY<span style="color:#f92672">=</span>your_lti_consumer_key
</span></span><span style="display:flex;"><span>LTI_CONSUMER_SECRET<span style="color:#f92672">=</span>your_lti_consumer_secret
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># LTI 1.3 LMS Domain</span>
</span></span><span style="display:flex;"><span>LTI_13_LMS_DOMAIN<span style="color:#f92672">=</span>https://canvas.instructure.com</span></span></code></pre></div>
      </div>
    </div>
  </div>
</div><h2 id="lms-configuration---lti-10">LMS Configuration - LTI 1.0</h2>
<p>The settings above can then be used to configure this application in your learning management system (LMS) using LTI 1.0. Refer to your LMS documentation for specific details. An example using Canvas is given below.</p>
<ul>
<li><strong>Consumer Key</strong> - <code>LTI_CONSUMER_KEY</code> from the app environment.</li>
<li><strong>Shared Secret</strong> - <code>LTI_CONSUMER_SECRET</code> from the app environment.</li>
<li><strong>XML Configuration URL</strong> - <code>DOMAIN_NAME</code> from the app environment followed by <code>/lti/provider/config10</code> by default. The URL can be configured in <code>app.js</code> as described below.
<ul>
<li>Additional settings for the XML configuration can be set in the <code>lti.js</code> config file.</li>
</ul>
</li>
<li><strong>Launch URL</strong> - <code>DOMAIN_NAME</code> from the app environment followed by <code>/lti/provider/launch10</code> by default. The URL can be configured in <code>app.js</code> as described below.</li>
<li><strong>Domain</strong> - typically the <code>DOMAIN_NAME</code> from the app environment without the <code>https://</code> at the front.</li>
<li><strong>Privacy Level</strong> - any option (&ldquo;Public&rdquo; provides all info, &ldquo;Anonymous&rdquo; omits most student info).</li>
</ul>
<h3 id="xml-configuration">XML Configuration</h3>
<p><a href="#R-image-b8cf241002771d6191e5a7ce139422cd" class="lightbox-link"><img alt="LTI 1.0 XML Configuration in Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/provider/images/lti10xml.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b8cf241002771d6191e5a7ce139422cd"><img alt="LTI 1.0 XML Configuration in Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/provider/images/lti10xml.png"></a></p>
<h3 id="manual-configuration">Manual Configuration</h3>
<p><a href="#R-image-c59bd2bf9d90020008b37ff6ed5f7dfa" class="lightbox-link"><img alt="LTI 1.0 Configuration in Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/provider/images/lti10.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c59bd2bf9d90020008b37ff6ed5f7dfa"><img alt="LTI 1.0 Configuration in Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/provider/images/lti10.png"></a></p>
<p>Once the application has been added to the course, an assignment can be created to direct students to the Launch URL used above.</p>
<p><a href="#R-image-7041faa3708a50ced8bb287c2a3aa65f" class="lightbox-link"><img alt="LTI 1.0 Assignment Configuration in Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/provider/images/lti10assign.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7041faa3708a50ced8bb287c2a3aa65f"><img alt="LTI 1.0 Assignment Configuration in Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/provider/images/lti10assign.png"></a></p>
<p>To access the rest of the application, students and teachers should use the assignment configured in the learning management system to perform an LTI Launch as described below.</p>
<h2 id="lti-toolkit-configuration">LTI Toolkit Configuration</h2>
<p>The <code>src/configs/lti.js</code> file contains a minimal configuration for the LTI Toolkit for use as an LTI 1.0 Tool Provider:</p>
<div class="tab-panel" data-tab-group="5704ef2e6da72ae7fdbcca1b0f12d08f">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="srcconfigsltijs"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('5704ef2e6da72ae7fdbcca1b0f12d08f','srcconfigsltijs')"
    >
      <span class="tab-nav-text">src/configs/lti.js</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="srcconfigsltijs"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @file Configuration information for LTI Toolkit
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @exports lti an LTI Toolkit instance configured for this app
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Import LTI Toolkit
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">LTIToolkit</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;lti-toolkit&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// LTI Launch Handler
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">LTILaunch</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;../routes/lti-launch.js&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Initialize LTI Toolkit
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">lti</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">LTIToolkit</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Domain name for this application
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">domain_name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">DOMAIN_NAME</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Logging Level
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">log_level</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">LOG_LEVEL</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;silly&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Use In-memory database for testing
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">db_storage</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;:memory:&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">provider</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Incoming LTI Launch Handler
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">handleLaunch</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">LTILaunch</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// LTI 1.0 Consumer Key and Shared Secret
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// for single LTI consumer setup
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">LTI_CONSUMER_KEY</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">secret</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">LTI_CONSUMER_SECRET</span>,
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">lti</span>;</span></span></code></pre></div>
      </div>
    </div>
  </div>
</div><p>It configures a default LTI 1.0 Tool Provider using the domain, key and secret provided in the environment. It also configures the log level and tells the system to use an in-memory database instance. Finally, it directs the library to the <code>LTILaunch</code> function provided by one of the routes as the handler for incoming LTI Launch Requests.</p>
<h2 id="integrating-application-routes">Integrating Application Routes</h2>
<p>The <code>app.js</code> file creates a basic <a href="https://www.npmjs.com/package/express" rel="external" target="_blank">Express</a> application with a minimal set of libraries and configuration.</p>
<div class="tab-panel" data-tab-group="fc1015406f0fe6758d0ca59661d538ce">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="appjs"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('fc1015406f0fe6758d0ca59661d538ce','appjs')"
    >
      <span class="tab-nav-text">app.js</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="appjs"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// Import LTI configuration
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">lti</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;./configs/lti.js&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Other imports here
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Create Express application
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">app</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">express</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Other configuration here
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Add LTI Toolkit Routes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;/lti/provider&#34;</span>, <span style="color:#a6e22e">lti</span>.<span style="color:#a6e22e">routers</span>.<span style="color:#a6e22e">provider</span>);</span></span></code></pre></div>
      </div>
    </div>
  </div>
</div><p>The details of that file are omitted (<em>read the source, you must</em>), but the notable configuration is shown above. The configured LTI Toolkit is imported, and then the LTI Provider Router is connected to the application at the <code>/lti/provider</code> path. So, any incoming requests sent to that URL will be passed to the LTI Toolkit for handling. This matches the route used when configuring the tool in Canvas as shown above.</p>
<h2 id="lti-launch-handler">LTI Launch Handler</h2>
<p>The LTI Launch Handler function will receive three parameters:</p>
<ul>
<li><code>launchData</code> - an instance of the <a href="/lti-toolkit/02-lti/03-launchdata/index.html">LTI Launch Data</a></li>
<li><code>consumer</code> - a Sequelize instance of an <a href="/lti-toolkit/00-general/01-database/index.html#lti-consumers">LTI Consumer</a> from the database</li>
<li><code>req</code> - the incoming Express request object</li>
</ul>
<p>In the example project, we use the following LTI Launch Handler:</p>
<div class="tab-panel" data-tab-group="92053c2a6a45b8f1b394e237aaa0f53a">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="srcrouteslti-launchjs"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('92053c2a6a45b8f1b394e237aaa0f53a','srcrouteslti-launchjs')"
    >
      <span class="tab-nav-text">src/routes/lti-launch.js</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="srcrouteslti-launchjs"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Handle an incoming LTI Launch Request
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Object} launchData - an LTI Launch Data object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Object} consumer - the LTI consumer object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Object} req - the Express request object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @returns {String} a URL to redirect the user to after launch
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">LTILaunch</span>(<span style="color:#a6e22e">launchData</span>, <span style="color:#a6e22e">consumer</span>, <span style="color:#a6e22e">req</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// We will store the LTI Launch Data and Consumer in the session for later use
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">ltiLaunchData</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">launchData</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">ltiConsumer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">consumer</span>.<span style="color:#a6e22e">toJSON</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Determine if the user is a teacher or student
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">isStudent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">parseRoles</span>(<span style="color:#a6e22e">launchData</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Record data in local data store
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">updateDataStore</span>(<span style="color:#a6e22e">launchData</span>, <span style="color:#a6e22e">isStudent</span>, <span style="color:#a6e22e">req</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Redirect user based on role
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isStudent</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;/student&#34;</span>;
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;/instructor&#34;</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
      </div>
    </div>
  </div>
</div><p>Notice that we serialize the <code>consumer</code> parameter to JSON since it is provided as a Sequelize object instance.</p>
<p>This handler users two helper functions. The first will parse the incoming roles in the <code>launchData</code> object:</p>
<div class="tab-panel" data-tab-group="fc9b154320f8168b88244fb45efcb68c">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="srcrouteslti-launchjs"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('fc9b154320f8168b88244fb45efcb68c','srcrouteslti-launchjs')"
    >
      <span class="tab-nav-text">src/routes/lti-launch.js</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="srcrouteslti-launchjs"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Parse LTI roles to determine user type
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Object} launchData - the LTI Launch Data object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @returns {Boolean} &#39;true&#39; if user is a student, &#39;false&#39; otherwise
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">parseRoles</span>(<span style="color:#a6e22e">launchData</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">launch_type</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;lti1.0&#34;</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// See https://www.imsglobal.org/specs/ltiv1p0/implementation-guide#toc-9
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">// LTI 1.0 roles are a long string
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">user_roles</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#e6db74">&#34;Learner&#34;</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">launch_type</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;lti1.3&#34;</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// See https://www.imsglobal.org/spec/lti/v1p3#role-vocabularies
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">// LTI 1.3 roles are an array of strings
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">user_roles</span>.<span style="color:#a6e22e">some</span>((<span style="color:#a6e22e">role</span>) =&gt; <span style="color:#a6e22e">role</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#e6db74">&#34;Learner&#34;</span>))) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Unknown LTI version
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#34;Unknown LTI launch type:&#34;</span>, <span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">launch_type</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#34;Error parsing roles:&#34;</span>, <span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#34;Roles data:&#34;</span>, <span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">user_roles</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
      </div>
    </div>
  </div>
</div><p>It will simply return <code>true</code> if the role is a student, otherwise it will treat the role as an instructor. This may or may not be desired behavior for a production application.</p>
<p>Finally, it also stores data about the incoming <code>launchData</code> in a shared data structure that is only stored in memory.</p>
<div class="tab-panel" data-tab-group="1ad14f645c2f2c25ed00a94c88af4b75">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="srcrouteslti-launchjs"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('1ad14f645c2f2c25ed00a94c88af4b75','srcrouteslti-launchjs')"
    >
      <span class="tab-nav-text">src/routes/lti-launch.js</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="srcrouteslti-launchjs"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Update local data store
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Object} launchData - the LTI Launch Data object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Boolean} isStudent - &#39;true&#39; if user is a student, &#39;false&#39; otherwise
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Object} req - the Express request object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">updateDataStore</span>(<span style="color:#a6e22e">launchData</span>, <span style="color:#a6e22e">isStudent</span>, <span style="color:#a6e22e">req</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// This is a placeholder function for updating a local data store
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// In a real application, you would implement logic to store
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// relevant launch data in your database or other storage system
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">courses</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">locals</span>.<span style="color:#a6e22e">dataStore</span>.<span style="color:#a6e22e">courses</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">courseId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">course_id</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">courses</span>[<span style="color:#a6e22e">courseId</span>]) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">courses</span>[<span style="color:#a6e22e">courseId</span>] <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">course_name</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">label</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">course_label</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">assignments</span><span style="color:#f92672">:</span> {},
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">assignments</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">courses</span>[<span style="color:#a6e22e">courseId</span>].<span style="color:#a6e22e">assignments</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">assignmentId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">assignment_id</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">assignments</span>[<span style="color:#a6e22e">assignmentId</span>]) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">assignments</span>[<span style="color:#a6e22e">assignmentId</span>] <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">assignment_name</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">lti_id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">assignment_lti_id</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">grade_url</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">outcome_url</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">grades</span><span style="color:#f92672">:</span> {},
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isStudent</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">userName</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">user_name</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">userId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">user_lis_id</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">userId13</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">user_lis13_id</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">outcomeId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">outcome_id</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">assignments</span>[<span style="color:#a6e22e">assignmentId</span>].<span style="color:#a6e22e">grades</span>[<span style="color:#a6e22e">userId</span>] <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">userName</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">lis_id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">userId</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">lis13_id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">userId13</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">outcome_id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">outcomeId</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">score</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
      </div>
    </div>
  </div>
</div><p>In practice, this would be replaced with appropriate code and logic to store this data in a database or other storage mechanism for the application. However, this data structure is instructive as it shows a minimal set of data that could be stored in order to track courses, assignments, students, and grades.</p>
<h2 id="student-grade-passback">Student Grade Passback</h2>
<p>Once a student&rsquo;s grade has been determined, it can be passed back to the learning management system (LMS) using the LTI Controller&rsquo;s <code>postGrade</code> method:</p>
<div class="tab-panel" data-tab-group="718283ed7dafafd8c06e2fa59d7c383e">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="srcroutesstudent-gradejs"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('718283ed7dafafd8c06e2fa59d7c383e','srcroutesstudent-gradejs')"
    >
      <span class="tab-nav-text">src/routes/student-grade.js</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="srcroutesstudent-gradejs"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Handle LTI Student Grade Postback
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Object} req - the Express request object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Object} res - the Express response object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">StudentGradeHandler</span>(<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Get LTI Launch Data and Consumer from session
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">launchData</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">ltiLaunchData</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">consumer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">ltiConsumer</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">error</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Get grade from form submission
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">grade</span> <span style="color:#f92672">=</span> parseFloat(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">grade</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (isNaN(<span style="color:#a6e22e">grade</span>) <span style="color:#f92672">||</span> <span style="color:#a6e22e">grade</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">grade</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">error</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Invalid grade value. Must be between 0 and 1.&#34;</span>;
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Post grade back to the LTI Provider
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// Build Grade Object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">gradeObject</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// LTI Consumer ID
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">consumer_id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">consumer</span>.<span style="color:#a6e22e">id</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// LTI 1.0 Outcome Information
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">grade_url</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">outcome_url</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">lms_grade_id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">outcome_id</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Grade value between 0.0 and 1.0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">score</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">grade</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// LTI 1.3 User ID
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">user_lis13_id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">user_lis13_id</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Helpful Debugging Information
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">debug</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// User Name
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">user</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">user_name</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// User ID (LTI 1.0 and LTI 1.3)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">user_id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">user_lis_id</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; (&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">user_lis13_id</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;)&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Assignment Name
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">assignment</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">assignment_name</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Assignment ID (LTI 1.0 and LTI 1.3)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">assignment_id</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">assignment_id</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;(&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">launchData</span>.<span style="color:#a6e22e">assignment_lti_id</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;)&#34;</span>,
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">lti</span>.<span style="color:#a6e22e">controllers</span>.<span style="color:#a6e22e">lti</span>.<span style="color:#a6e22e">postGrade</span>(<span style="color:#a6e22e">gradeObject</span>)) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`Successfully posted grade of </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">grade</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> back to the LMS.`</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Record grade in local data store
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">updateDataStoreWithGrade</span>(<span style="color:#a6e22e">launchData</span>, <span style="color:#a6e22e">grade</span>, <span style="color:#a6e22e">req</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">error</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Failed to post grade back to the LMS.&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Render student view with LTI Launch Data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">render</span>(<span style="color:#e6db74">&#34;student.njk&#34;</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;LTI Tool Provider - Student View&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">message</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">message</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">error</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">launchData</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">launchData</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">consumer</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">consumer</span>,
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
      </div>
    </div>
  </div>
</div><p>This method constructs the grade object required by the <code>postGrade</code> method using data from the LTI Launch Data and the LTI Consumer originally provided to the LTI Launch Handler. In this example, those values are read directly from the user&rsquo;s session.</p>
<h2 id="instructor-grade-passback">Instructor Grade Passback</h2>
<p>A more advanced example of submitting grades could involve the instructor providing grades after a student has completed an assignment:</p>
<div class="tab-panel" data-tab-group="1ffe31e0ed06372978d1a8b2145b45d1">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="srcroutesinstructor-gradejs"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('1ffe31e0ed06372978d1a8b2145b45d1','srcroutesinstructor-gradejs')"
    >
      <span class="tab-nav-text">src/routes/instructor-grade.js</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="srcroutesinstructor-gradejs"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Handle LTI Instructor Grade Postback
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Object} req - the Express request object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Object} res - the Express response object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">InstructorGradeHandler</span>(<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Get LTI Launch Data and Consumer from session
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">launchData</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">ltiLaunchData</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">consumer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">ltiConsumer</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">error</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Get form data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">courseId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">course</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">assignmentId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">assignment</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">userId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">user</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">grade</span> <span style="color:#f92672">=</span> parseFloat(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">grade</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Get assignment and user info from local data store
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// This is a placeholder function for updating a local data store
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// In a real application, you would implement logic to store
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// relevant grade data in your database or other storage system
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">courses</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">locals</span>.<span style="color:#a6e22e">dataStore</span>.<span style="color:#a6e22e">courses</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">assignments</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">courses</span>[<span style="color:#a6e22e">courseId</span>].<span style="color:#a6e22e">assignments</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (isNaN(<span style="color:#a6e22e">grade</span>) <span style="color:#f92672">||</span> <span style="color:#a6e22e">grade</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">grade</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">error</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Invalid grade value. Must be between 0 and 1.&#34;</span>;
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Post grade back to the LTI Provider
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// Build Grade Object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">gradeObject</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// LTI Consumer ID
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">consumer_id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">consumer</span>.<span style="color:#a6e22e">id</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// LTI 1.0 Outcome Information
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">grade_url</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">assignments</span>[<span style="color:#a6e22e">assignmentId</span>].<span style="color:#a6e22e">grade_url</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">lms_grade_id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">assignments</span>[<span style="color:#a6e22e">assignmentId</span>].<span style="color:#a6e22e">grades</span>[<span style="color:#a6e22e">userId</span>].<span style="color:#a6e22e">outcome_id</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Grade value between 0.0 and 1.0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">score</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">grade</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// LTI 1.3 User ID
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">user_lis13_id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">assignments</span>[<span style="color:#a6e22e">assignmentId</span>].<span style="color:#a6e22e">grades</span>[<span style="color:#a6e22e">userId</span>].<span style="color:#a6e22e">lis13_id</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Helpful Debugging Information
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">debug</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// User Name
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">user</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">assignments</span>[<span style="color:#a6e22e">assignmentId</span>].<span style="color:#a6e22e">grades</span>[<span style="color:#a6e22e">userId</span>].<span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// User ID (LTI 1.0 and LTI 1.3)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">user_id</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">assignments</span>[<span style="color:#a6e22e">assignmentId</span>].<span style="color:#a6e22e">grades</span>[<span style="color:#a6e22e">userId</span>].<span style="color:#a6e22e">lis_id</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34; (&#34;</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">assignments</span>[<span style="color:#a6e22e">assignmentId</span>].<span style="color:#a6e22e">grades</span>[<span style="color:#a6e22e">userId</span>].<span style="color:#a6e22e">lis13_id</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;)&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Assignment Name
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">assignment</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">assignments</span>[<span style="color:#a6e22e">assignmentId</span>].<span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Assignment ID (LTI 1.0 and LTI 1.3)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">assignment_id</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">assignmentId</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;(&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">assignments</span>[<span style="color:#a6e22e">assignmentId</span>].<span style="color:#a6e22e">lti_id</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;)&#34;</span>,
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">lti</span>.<span style="color:#a6e22e">controllers</span>.<span style="color:#a6e22e">lti</span>.<span style="color:#a6e22e">postGrade</span>(<span style="color:#a6e22e">gradeObject</span>)) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`Successfully posted grade of </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">grade</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> back to the LMS.`</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Record grade in local data store
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">assignments</span>[<span style="color:#a6e22e">assignmentId</span>].<span style="color:#a6e22e">grades</span>[<span style="color:#a6e22e">userId</span>].<span style="color:#a6e22e">score</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">grade</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">error</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Failed to post grade back to the LMS.&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Render instructor view with LTI Launch Data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">render</span>(<span style="color:#e6db74">&#34;instructor.njk&#34;</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;LTI Tool Provider - Instructor View&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">message</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">message</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">error</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">courses</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">locals</span>.<span style="color:#a6e22e">dataStore</span>.<span style="color:#a6e22e">courses</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">launchData</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">launchData</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">consumer</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">consumer</span>,
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
      </div>
    </div>
  </div>
</div><p>In this example, the same data required to build a grade object is read from the shared data structure stored in memory. Again, in practice, this data would be read from a database or another storage mechanism, but this code should be instructive.</p>
<h2 id="lti-13-configuration">LTI 1.3 Configuration</h2>
<p>Configuring an application to use the LTI 1.3 protocol is a bit more complex, and requires several steps in both the learning management system (LMS) as well as this tool. Detailed instructions and configuration information can be found at the <code>/admin</code> route in the example application, and also are discussed below.</p>
<h3 id="step-1---add-an-lti-13-application-in-the-lms">Step 1 - Add an LTI 1.3 Application in the LMS</h3>
<p>The first step is to add an LTI 1.3 application to the learning management system. In Canvas, this requires administrator access, so you may have to work with your Canvas administrator to accomplish this step. In Canvas, go to the Admin panel for the account used and find the Developer Keys page, then add a new LTI Key.</p>
<ul>
<li><strong>Redirect URIs</strong>: <code>DOMAIN_NAME</code> from the app environment followed by <code>/lti/provider/redirect13</code> by default.</li>
<li><strong>Target Link URIs</strong>: <code>DOMAIN_NAME</code> from the app environment followed by <code>/lti/provider/launch13</code> by default.</li>
<li><strong>OpenID Connect Initiation Url</strong>: <code>DOMAIN_NAME</code> from the app environment followed by <code>/lti/provider/login13/</code> and then the <code>LTI_CONSUMER_KEY</code> from the app environment by default.</li>
<li><strong>JWK Method</strong>: Public JWK URL (this library only supports JWKS via URL)</li>
<li><strong>Public JWK URL</strong>: <code>DOMAIN_NAME</code> from the app environment followed by <code>/lti/provider/key13</code> by default.</li>
</ul>
<p>The base of these URLs can be configured in <code>app.js</code> as discussed above.</p>
<p><a href="#R-image-abbc1c03d1c73705eff9c38fba67a570" class="lightbox-link"><img alt="LTI 1.3 Key Configuration in Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/provider/images/lti13admin1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-abbc1c03d1c73705eff9c38fba67a570"><img alt="LTI 1.3 Key Configuration in Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/provider/images/lti13admin1.png"></a></p>
<p>In the LTI Advantage Services configuration, at a minimum the &ldquo;Can create and update submission results for assignments associated with the tool&rdquo; must be selected, which will allow this application to send grades back to the learning management system.</p>
<p><a href="#R-image-5056df2cc9ce1d2b02c496e1b5069fe8" class="lightbox-link"><img alt="LTI 1.3 Advantage Services in Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/provider/images/lti13admin2.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5056df2cc9ce1d2b02c496e1b5069fe8"><img alt="LTI 1.3 Advantage Services in Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/provider/images/lti13admin2.png"></a></p>
<p>At the bottom, the privacy level may be set to any value. The &ldquo;Public&rdquo; option provides all data about students (name, email, image). Other privacy levels may omit some of this data.</p>
<p><a href="#R-image-314f60deeabecfa57926732bec994da6" class="lightbox-link"><img alt="LTI 1.3 Privacy Configuration in Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/provider/images/lti13admin3.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-314f60deeabecfa57926732bec994da6"><img alt="LTI 1.3 Privacy Configuration in Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/provider/images/lti13admin3.png"></a></p>
<p>Once the LTI Key is created, a Client ID is provided by Canvas. Make a note of this value for later. Also, make sure the LTI Key is enabled here.</p>
<p><a href="#R-image-4cb2713fcd408f40f967cc5854667c8b" class="lightbox-link"><img alt="LTI 1.3 Client ID in Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/provider/images/lti13admin4.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-4cb2713fcd408f40f967cc5854667c8b"><img alt="LTI 1.3 Client ID in Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/provider/images/lti13admin4.png"></a></p>
<h3 id="step-2---add-lti-13-application-to-a-course">Step 2 - Add LTI 1.3 Application to a Course</h3>
<p>Once the LTI 1.3 Key is created, the application can be added to a course within the learning management system. In Canvas, this can be found on the Settings of a course on the Apps tab. Click the button to add a new application, and enter the Client ID from Step 1 above.</p>
<p><a href="#R-image-1a4792a92be1c39e1cdcc9265b545bf7" class="lightbox-link"><img alt="LTI 1.3 Add App to Course in Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/provider/images/lti13course1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-1a4792a92be1c39e1cdcc9265b545bf7"><img alt="LTI 1.3 Add App to Course in Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/provider/images/lti13course1.png"></a></p>
<p>Once the application has been added to the course, click the menu next to the application and display the Deployment ID for the application. Save this value for later.</p>
<p><a href="#R-image-21f58fc191e7172615dae9e3c23fa5bc" class="lightbox-link"><img alt="LTI 1.3 Deployment ID in Canvas" class="border lazy lightbox figure-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/provider/images/lti13course2.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-21f58fc191e7172615dae9e3c23fa5bc"><img alt="LTI 1.3 Deployment ID in Canvas" class="border lazy lightbox lightbox-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/provider/images/lti13course2.png"></a></p>
<h3 id="step-3---configure-lti-13-settings">Step 3 - Configure LTI 1.3 Settings</h3>
<p>Back in the LTI Provider Demo application, click the link on the homepage or navigate to the <code>/admin</code> page to access the LTI 1.3 configuration. On this page, enter the LTI 1.3 configuration information for your learning management system. Examples below are shown for Canvas using the configuration provided in the steps above.</p>
<ul>
<li><strong>LTI 1.3 Client ID:</strong> From Step 1 Above</li>
<li><strong>LTI 1.3 Platform ID:</strong> This is usually just the URL of the LMS</li>
<li><strong>LTI 1.3 Deployment ID:</strong> From Step 2 Above</li>
<li><strong>LTI 1.3 JWKS Keyset URL:</strong> For Canvas, <code>/api/lti/security/jwks</code></li>
<li><strong>LTI 1.3 Token URL:</strong> For Canvas, <code>/login/oauth2/token</code></li>
<li><strong>LTI 1.3 Auth URL:</strong> For Canvas, <code>/api/lti/authorize_redirect</code></li>
</ul>
<p><a href="#R-image-d303a86549a0e8ac5925959a0cc975ce" class="lightbox-link"><img alt="LTI 1.3 Consumer Configuration" class="border lazy lightbox figure-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/provider/images/lti13app1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d303a86549a0e8ac5925959a0cc975ce"><img alt="LTI 1.3 Consumer Configuration" class="border lazy lightbox lightbox-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/provider/images/lti13app1.png"></a></p>
<h3 id="step-4---configure-lms-assignment">Step 4 - Configure LMS Assignment</h3>
<p>In Canvas, configure an assignment that uses an external URL (similar to working with LTI 1.0 Applications as shown below). This time, it will use the Target Link URI configured in Step 1 - typically the <code>DOMAIN_NAME</code> from the environment followed by <code>/lti/provider/launch13</code>.</p>
<p><a href="#R-image-3a8f155e48e136ca1d67b50c38cdc322" class="lightbox-link"><img alt="LTI 1.3 Assignment Configuration" class="border lazy lightbox figure-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/provider/images/lti13assign1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-3a8f155e48e136ca1d67b50c38cdc322"><img alt="LTI 1.3 Assignment Configuration" class="border lazy lightbox lightbox-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/provider/images/lti13assign1.png"></a></p>
<p>From this point onward, students and teachers can access the LTI Demo Application through this Canvas assignment to perform an LTI 1.3 Launch.</p>
<h2 id="managing-lti-consumers">Managing LTI Consumers</h2>
<p>Within the sample application, the Admin Configuration handler gives a demonstration for using this library&rsquo;s controllers to manage the LTI Consumers available within the application.</p>
<div class="tab-panel" data-tab-group="1e92ba7b8f4f2c2e8a5fb89bb77e6c62">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="srcroutesadmin-configjs"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('1e92ba7b8f4f2c2e8a5fb89bb77e6c62','srcroutesadmin-configjs')"
    >
      <span class="tab-nav-text">src/routes/admin-config.js</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="srcroutesadmin-configjs"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Handle LTI Admin Launch
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Object} req - the Express request object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Object} res - the Express response object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">AdminConfigHandler</span>(<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">error</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Get Form Data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lti13</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">client_id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">client_id</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">platform_id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">platform_id</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">deployment_id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">deployment_id</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">keyset_url</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">keyset_url</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">token_url</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">token_url</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">auth_url</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">auth_url</span>,
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Check if any required fields are missing
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">requiredFields</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;client_id&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;platform_id&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;deployment_id&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;keyset_url&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;token_url&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;auth_url&#34;</span>,
</span></span><span style="display:flex;"><span>  ];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">missingFields</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">requiredFields</span>.<span style="color:#a6e22e">filter</span>(
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">field</span>) =&gt; <span style="color:#f92672">!</span><span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">field</span>] <span style="color:#f92672">||</span> <span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">field</span>].<span style="color:#a6e22e">trim</span>() <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">missingFields</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">error</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;Missing required fields: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">missingFields</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;, &#34;</span>);
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Update Consumer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">returnValue</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">lti</span>.<span style="color:#a6e22e">controllers</span>.<span style="color:#a6e22e">consumer</span>.<span style="color:#a6e22e">updateConsumer</span>(<span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">data</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">returnValue</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#34;Consumer not found&#34;</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">error</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Failed to update consumer: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">message</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Successfully updated consumer.&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Get Updated LTI Consumer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">consumers</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">lti</span>.<span style="color:#a6e22e">controllers</span>.<span style="color:#a6e22e">consumer</span>.<span style="color:#a6e22e">getAll</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">consumer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">consumers</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">toJSON</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Get LMS Domain
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">lmsDomain</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">LTI_13_LMS_DOMAIN</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;https://canvas.instructure.com&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">render</span>(<span style="color:#e6db74">&#34;admin.njk&#34;</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;LTI Tool Provider - Admin Configuration View&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">consumer</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">consumer</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lmsDomain</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">lmsDomain</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">domain</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">DOMAIN_NAME</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">LTI_CONSUMER_KEY</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">error</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">message</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">message</span>,
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
      </div>
    </div>
  </div>
</div><p>This handler receives data provided in the LTI 1.3 configuration form, validates that all items are present (more validation could be performed as desired), and then it uses the Consumer controller provided through the library to update the default LTI Consumer (with ID <code>1</code>) to include the LTI 1.3 configuration options. The Consumer controller provides additional methods to add and delete additional consumers as desired.</p>

<details open class=" box cstyle notices warning">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-exclamation-triangle"></i> 
    Warning
  </summary>
  <div class="box-content">
<p>Be aware that, by providing both a <code>key</code> and <code>secret</code> as part of the <code>provider</code> configuration in the LTI Toolkit configuration (see <code>src/configs/lti.js</code>), all existing LTI consumers will be removed from the database each time the application is launched. So, those options must be removed and LTI Consumers must be configured directly through the controller if multiple consumers are desired.</p>
  </div>
</details>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="lti-consumer">LTI Consumer</h1>

<p>A fully-featured LTI Tool Consumer example can be found in <code>/examples/consumer</code>. This document will walk through the details of how that application works.</p>
<h2 id="environment">Environment</h2>
<p>The application expects the following environment variables (typically loaded from <code>.env</code>):</p>
<div class="tab-panel" data-tab-group="11786aca959034b8a155064767b53258">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="env"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('11786aca959034b8a155064767b53258','env')"
    >
      <span class="tab-nav-text">.env</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="env"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-env" data-lang="env"><span style="display:flex;"><span><span style="color:#75715e"># Express Session Secret</span>
</span></span><span style="display:flex;"><span>SESSION_SECRET<span style="color:#f92672">=</span>your_session_secret
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Log Level</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># One of error warn info http verbose lti debug sql silly</span>
</span></span><span style="display:flex;"><span>LOG_LEVEL<span style="color:#f92672">=</span>lti
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Application Domain Name</span>
</span></span><span style="display:flex;"><span>DOMAIN_NAME<span style="color:#f92672">=</span>https://ltidemo.home.russfeld.me
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># LTI Tool Consumer Settings</span>
</span></span><span style="display:flex;"><span>ADMIN_EMAIL<span style="color:#f92672">=</span>admin@domain.tld
</span></span><span style="display:flex;"><span>DEPLOYMENT_NAME<span style="color:#f92672">=</span>LTI Toolkit Demo
</span></span><span style="display:flex;"><span>DEPLOYMENT_ID<span style="color:#f92672">=</span>deployment-001</span></span></code></pre></div>
      </div>
    </div>
  </div>
</div><h2 id="lti-toolkit-configuration">LTI Toolkit Configuration</h2>
<p>The <code>src/configs/lti.js</code> file contains a minimal configuration for the LTI Toolkit for use as an LTI 1.0 Tool Consumer:</p>
<div class="tab-panel" data-tab-group="d1b5040847da86b31dd86fdaa03f613b">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="srcconfigsltijs"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('d1b5040847da86b31dd86fdaa03f613b','srcconfigsltijs')"
    >
      <span class="tab-nav-text">src/configs/lti.js</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="srcconfigsltijs"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @file Configuration information for LTI Toolkit
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @exports lti an LTI Toolkit instance configured for this app
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Import LTI Toolkit
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">LTIToolkit</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;lti-toolkit&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// LTI Post Provider Grade Handler
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">postProviderGrade</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;../routes/post-grade.js&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Initialize LTI Toolkit
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">lti</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">LTIToolkit</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Domain name for this application
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">domain_name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">DOMAIN_NAME</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Logging Level
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">log_level</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">LOG_LEVEL</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;silly&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Use In-memory database for testing
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">db_storage</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;:memory:&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Consumer Configuration
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">consumer</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Incoming grade handler
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">postProviderGrade</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">postProviderGrade</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// LTI Tool Consumer Information
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">admin_email</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">ADMIN_EMAIL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">deployment_name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">DEPLOYMENT_NAME</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">deployment_id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">DEPLOYMENT_ID</span>,
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">lti</span>;</span></span></code></pre></div>
      </div>
    </div>
  </div>
</div><p>It configures a default LTI 1.0 Tool Consumer using the domain provided in the environment. It also configures the log level and tells the system to use an in-memory database instance. In addition, it provides some configuration information about the LTI 1.0 Tool Consumer using the information provided in the environment. Finally, it directs the library to the <code>postProviderGrade</code> function provided by one of the routes as the handler for incoming LTI grade passback.</p>
<h2 id="integrating-application-routes">Integrating Application Routes</h2>
<p>The <code>app.js</code> file creates a basic <a href="https://www.npmjs.com/package/express" rel="external" target="_blank">Express</a> application with a minimal set of libraries and configuration.</p>
<div class="tab-panel" data-tab-group="c9005792b6c2a7d942c6241a30a7289b">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="appjs"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('c9005792b6c2a7d942c6241a30a7289b','appjs')"
    >
      <span class="tab-nav-text">app.js</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="appjs"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// Import LTI configuration
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">lti</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;./configs/lti.js&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Other imports here
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Create Express application
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">app</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">express</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Other configuration here
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Add LTI Toolkit Routes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;/lti/consumer&#34;</span>, <span style="color:#a6e22e">lti</span>.<span style="color:#a6e22e">routers</span>.<span style="color:#a6e22e">consumer</span>);</span></span></code></pre></div>
      </div>
    </div>
  </div>
</div><p>The details of that file are omitted (<em>read the source, you must</em>), but the notable configuration is shown above. The configured LTI Toolkit is imported, and then the LTI Provider Router is connected to the application at the <code>/lti/consumer</code> path. So, any incoming requests sent to that URL will be passed to the LTI Toolkit for handling. This matches the default route in the toolkit configuration; if this route is changed, it must also be provided in the configuration.</p>
<h2 id="adding-an-lti-10-tool-provider">Adding an LTI 1.0 Tool Provider</h2>
<p>Once the application is launched, the first step is to add an LTI 1.0 Tool Provider from the homepage. Each LTI 1.0 Tool Provider is a little different, so consult the instructions for adding that provider to your LMS. Currently this application only supports manually configured tools (configuration via XML is not currently supported).</p>
<p>Required settings:</p>
<ul>
<li><strong>Provider Name</strong> - a memorable name for the LTI Tool Provider</li>
<li><strong>LTI 1.0 Shared Key</strong> - the shared key used with this provider</li>
<li><strong>LTI 1.0 Shared Secret</strong> - the shared secret used with this provider</li>
<li><strong>LTI 1.0 Launch URL</strong> - the launch URL for the LTI Tool Provider.</li>
<li><strong>LTI 1.0 Tool Provider Domain</strong> - the domain for the LTI Tool Provider</li>
<li><strong>Use Sections?</strong> - enable if the LTI Tool Provider requires special section configuration
<ul>
<li>Currently this does nothing in the library itself, but may be useful for applications implementing LTI Tool Consumer functionality</li>
</ul>
</li>
<li><strong>LTI 1.0 Custom Values</strong> - set custom values for the LTI 1.0 Launch Request (currently unsupported)</li>
<li><strong>LTI 1.0 Enabled</strong> - enable LTI 1.3 Tool Providers (currently unsupported)</li>
</ul>
<p>An example configuration for connecting to <a href="https://www.prairielearn.com/" rel="external" target="_blank">PrairieLearn</a> is shown below:</p>
<p><a href="#R-image-1497dd0da4d95728a9b23eb416186f80" class="lightbox-link"><img alt="LTI 1.0 Tool Provider Configuration" class="border lazy lightbox figure-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/consumer/images/ltitool.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-1497dd0da4d95728a9b23eb416186f80"><img alt="LTI 1.0 Tool Provider Configuration" class="border lazy lightbox lightbox-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/consumer/images/ltitool.png"></a></p>
<p>LTI 1.0 Tool Providers are added to the system using the <code>Provider</code> controller as shown in the <code>configure</code> handler.</p>
<div class="tab-panel" data-tab-group="c51f886a66ce25f7e3520f7a6cbcfe56">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="srcroutesconfigurejs"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('c51f886a66ce25f7e3520f7a6cbcfe56','srcroutesconfigurejs')"
    >
      <span class="tab-nav-text">src/routes/configure.js</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="srcroutesconfigurejs"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Handle LTI Tool Provider Configuration
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Object} req - the Express request object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Object} res - the Express response object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">ProviderConfigHandler</span>(<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">error</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Get Form Data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// LTI 1.3 is not supported
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">lti13</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">key</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">secret</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">secret</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">launch_url</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">launch_url</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">domain</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">domain</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// custom values are unsupported in this example
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">custom</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// use_section is optional
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">use_section</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">use_section</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;true&#34;</span>,
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Check if any required fields are missing
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">requiredFields</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#34;key&#34;</span>, <span style="color:#e6db74">&#34;secret&#34;</span>, <span style="color:#e6db74">&#34;launch_url&#34;</span>, <span style="color:#e6db74">&#34;domain&#34;</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">missingFields</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">requiredFields</span>.<span style="color:#a6e22e">filter</span>(
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">field</span>) =&gt; <span style="color:#f92672">!</span><span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">field</span>] <span style="color:#f92672">||</span> <span style="color:#a6e22e">data</span>[<span style="color:#a6e22e">field</span>].<span style="color:#a6e22e">trim</span>() <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">missingFields</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">error</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Missing required fields: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">missingFields</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;, &#34;</span>);
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Create Provider
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">lti</span>.<span style="color:#a6e22e">controllers</span>.<span style="color:#a6e22e">provider</span>.<span style="color:#a6e22e">createProvider</span>(<span style="color:#a6e22e">data</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">error</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Failed to create provider: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">message</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Successfully created provider.&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Get list of configured tool providers
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">providers</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">lti</span>.<span style="color:#a6e22e">controllers</span>.<span style="color:#a6e22e">provider</span>.<span style="color:#a6e22e">getAll</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Get secrets for each provider and convert to JSON-friendly format
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">providerData</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">provider</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">providers</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">providerSecret</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">lti</span>.<span style="color:#a6e22e">controllers</span>.<span style="color:#a6e22e">provider</span>.<span style="color:#a6e22e">getSecret</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">provider</span>.<span style="color:#a6e22e">id</span>,
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">providerData</span>.<span style="color:#a6e22e">push</span>({ ...<span style="color:#a6e22e">provider</span>.<span style="color:#a6e22e">toJSON</span>(), <span style="color:#a6e22e">secret</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">providerSecret</span> });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Render index view
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">render</span>(<span style="color:#e6db74">&#34;index.njk&#34;</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;LTI Tool Consumer - Index&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">domain</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">DOMAIN_NAME</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">providers</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">providerData</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">error</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">message</span>,
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
      </div>
    </div>
  </div>
</div><p>Once an LTI 1.0 Tool Provider is configured, it will be listed on the index page. Click the link to access it.</p>
<p><a href="#R-image-b846b0fbcef62f3df4c19ea222257b07" class="lightbox-link"><img alt="LTI 1.0 Tool Provider List" class="border lazy lightbox figure-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/consumer/images/ltitool2.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b846b0fbcef62f3df4c19ea222257b07"><img alt="LTI 1.0 Tool Provider List" class="border lazy lightbox lightbox-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/consumer/images/ltitool2.png"></a></p>
<h2 id="configuring-an-lti-10-launch-request">Configuring an LTI 1.0 Launch Request</h2>
<p>A fully-configured LTI 1.0 Launch Request requires several pieces of information. Generally this information is part of the internal functionalty of the learning management system (LMS) that is implementing LTI 1.0 Tool Consumer functionality. For this example, we instead just use hand-entered values to simulate this process. In an actual LMS, most of this data would already be present.</p>
<p>For all of the items listed below, the <strong>key</strong> values should not be the sequentially autogenerated database IDs, as that may leak internal data from the LMS and allow malicious users to guess other valid values. Intead, these values should be unique and randomly generated, such as <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier" rel="external" target="_blank">UUIDs</a> or similar, but they should be consistent (i.e. a key should uniquely identify an item, and that item should always use the same key). Internally, this library uses the <a href="https://www.npmjs.com/package/nanoid" rel="external" target="_blank">nanoid</a> package to generate random ID values.</p>
<ul>
<li><strong>Context</strong> - Generally, the context of an LTI launch refers to a course in the LMS
<ul>
<li><strong>Key</strong> - a uniquely identifiable key for the course</li>
<li><strong>Label</strong> - a short label for the course (e.g. &ldquo;LTI 101&rdquo;)</li>
<li><strong>Name</strong> - a long name for the course (e.g. &ldquo;LTI Demo Course&rdquo;)</li>
</ul>
</li>
<li><strong>Resource</strong> - A resource in an LTI launch refers to a specific assignment within the LMS
<ul>
<li><strong>Key</strong> - a uniquely identifiable key for the assignment</li>
<li><strong>Name</strong> - a long name for the assignment (e.g. &ldquo;LTI Demo Assignment&rdquo;)</li>
</ul>
</li>
<li><strong>User</strong> - Information about the user for the LTI launch. This tool does not currently support anonymous LTI launches.
<ul>
<li><strong>Key</strong> - a uniquely identifiable key for the user</li>
<li><strong>Email</strong> - the email address associated with the user. Most LTI Tool Providers use the email address to uniquely identify users within their own systems.</li>
<li><strong>Given Name</strong> - the given name, sometimes referred to as the first name, of the user</li>
<li><strong>Family Name</strong> - the family name, sometimes referred to as the last name or surname, of the user</li>
</ul>
</li>
<li><strong>Launch Type</strong> - currently this tool only supports launching as either an &ldquo;Instructor&rdquo; or &ldquo;Learner&rdquo; role</li>
<li><strong>Gradebook Key</strong> - a uniquely identifiable key for the gradebook line item. This can be used to differentiate between individual launches to the same LTI Tool Provider, or to differentiate between launches to different LTI Tool Providers using the same context and resource keys.</li>
</ul>
<p>This sample application provides default values for all of these options in the form to configure the launch.</p>
<p><a href="#R-image-c20c1c4ce7d4a202b195740a4ebe31b9" class="lightbox-link"><img alt="LTI 1.0 Launch Configuration" class="border lazy lightbox figure-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/consumer/images/ltilaunch.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c20c1c4ce7d4a202b195740a4ebe31b9"><img alt="LTI 1.0 Launch Configuration" class="border lazy lightbox lightbox-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/consumer/images/ltilaunch.png"></a></p>
<p>Once the launch is configured, click the &ldquo;Submit&rdquo; button to prepare the LTI 1.0 Launch page. This is handled by the <code>provider-launch</code> handler in the demo application. In short, it collects all of the form data and constructs the parameters for the <code>generateLTI10FormData</code> function in the LTI controller:</p>
<div class="tab-panel" data-tab-group="db26d68771c3117b4006431a8d913c8a">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="srcroutesprovider-launchjs"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('db26d68771c3117b4006431a8d913c8a','srcroutesprovider-launchjs')"
    >
      <span class="tab-nav-text">src/routes/provider-launch.js</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="srcroutesprovider-launchjs"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Provider Launch Handler for LTI Tool Consumer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Object} req - the Express request object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Object} res - the Express response object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">ProviderLaunchHandler</span>(<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">error</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">providerId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">params</span>.<span style="color:#a6e22e">id</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Get Provider
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">provider</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">lti</span>.<span style="color:#a6e22e">controllers</span>.<span style="color:#a6e22e">provider</span>.<span style="color:#a6e22e">getById</span>(<span style="color:#a6e22e">providerId</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">provider</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">404</span>).<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#34;Provider not found&#34;</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Get Secret
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">providerSecret</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">lti</span>.<span style="color:#a6e22e">controllers</span>.<span style="color:#a6e22e">provider</span>.<span style="color:#a6e22e">getSecret</span>(<span style="color:#a6e22e">provider</span>.<span style="color:#a6e22e">id</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Formatted provider including secret
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">providerData</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">provider</span>.<span style="color:#a6e22e">toJSON</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">providerData</span>.<span style="color:#a6e22e">secret</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">providerSecret</span>.<span style="color:#a6e22e">secret</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Get Form Data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">context</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">context_key</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">label</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">context_label</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">context_name</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">resource</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">resource_key</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">resource_name</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">user</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">user_key</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">email</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">user_email</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">given_name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">user_given_name</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">family_name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">user_family_name</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">user_given_name</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">user_family_name</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">manager</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">manager</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;true&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gradebook_id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">gradebook_id</span>,
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Check if any required fields are missing
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">requiredFields</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;context.key&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;context.label&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;context.name&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;resource.key&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;resource.name&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;user.key&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;user.email&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;user.given_name&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;user.family_name&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;manager&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;gradebook_id&#34;</span>,
</span></span><span style="display:flex;"><span>  ];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">missingFields</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">requiredFields</span>.<span style="color:#a6e22e">filter</span>((<span style="color:#a6e22e">field</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Handle nested fields
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fieldParts</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">field</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;.&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">part</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">fieldParts</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">value</span>[<span style="color:#a6e22e">part</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">value</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">undefined</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">value</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">undefined</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">toString</span>().<span style="color:#a6e22e">trim</span>() <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">missingFields</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">error</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Missing required fields: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">missingFields</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;, &#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Render provider view
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">render</span>(<span style="color:#e6db74">&#34;provider.njk&#34;</span>, {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`LTI Tool Consumer - Provider: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">provider</span>.<span style="color:#a6e22e">name</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">provider</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">providerData</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">error</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">message</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">message</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Store launch data in local data store
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">updateDataStoreWithLaunch</span>(<span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">providerData</span>, <span style="color:#a6e22e">req</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Create LTI Launch
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">launch</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">lti</span>.<span style="color:#a6e22e">controllers</span>.<span style="color:#a6e22e">lti</span>.<span style="color:#a6e22e">generateLTI10FormData</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">providerData</span>.<span style="color:#a6e22e">key</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">providerData</span>.<span style="color:#a6e22e">secret</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">providerData</span>.<span style="color:#a6e22e">launch_url</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;/provider/&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">providerData</span>.<span style="color:#a6e22e">id</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">context</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">resource</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">user</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">manager</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">gradebook_id</span>,
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Render template
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">render</span>(<span style="color:#e6db74">&#34;launch.njk&#34;</span>, {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">launch</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
      </div>
    </div>
  </div>
</div><p>The <code>generateLTI10FormData</code> function returns an object with 2 attributes:</p>
<ul>
<li><code>action</code> : the LTI Launch URL to send the request to</li>
<li><code>fields</code> : a set of fields to be sent in the LTI Launch</li>
</ul>
<h2 id="sending-an-lti-launch-request">Sending an LTI Launch Request</h2>
<p>LTI 1.0 Launch Requests must be sent by the user&rsquo;s browser. The easiest way to do this is by constructing a form on the webpage with only hidden fields, and then having the user click a button to submit the form to the LTI Launch URL of the LTI 1.0 Tool Provider. The form can also be configured to submit automatically if desired.</p>
<p>The <code>launch.njk</code> template demonstrates how to generate this page using the <a href="https://www.npmjs.com/package/nunjucks" rel="external" target="_blank">Nunjucks</a> template engine.</p>
<div class="tab-panel" data-tab-group="d148300cc15afced0ec1a53b3284896f">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="srcviewslaunchnjk"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('d148300cc15afced0ec1a53b3284896f','srcviewslaunchnjk')"
    >
      <span class="tab-nav-text">src/views/launch.njk</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="srcviewslaunchnjk"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">
<div class="highlight" dir="auto"><pre tabindex="0"><code class="language-njk" data-lang="njk">&lt;form method=&#34;POST&#34; action=&#34;{{ launch.action }}&#34;&gt;
  {% for attr, value in launch.fields %}
  &lt;input type=&#34;hidden&#34; id=&#34;{{ attr }}&#34; name=&#34;{{ attr }}&#34; value=&#34;{{ value }}&#34; /&gt;
  {% endfor %}
  &lt;input type=&#34;submit&#34; value=&#34;LTI Launch&#34;&gt;
&lt;/form&gt;</code></pre></div>
      </div>
    </div>
  </div>
</div><p>Below is another helpful example for creating a similar page using a <a href="https://vuejs.org/" rel="external" target="_blank">Vue.js</a> component:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vue" data-lang="vue"><span style="display:flex;"><span>&lt;<span style="color:#f92672">template</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;auto-form&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">form</span> <span style="color:#f92672">v-if</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;form&#34; :action=&#34;form.action&#34; method=&#34;POST&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">input</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">v-for</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;(value, key) in form.fields&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">:key</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;key&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">:name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;key&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">:value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;value&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hidden&#34;</span>
</span></span><span style="display:flex;"><span>      /&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">Button</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">label</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Launch Lesson&#34;</span> <span style="color:#a6e22e">severity</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;primary&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">template</span>&gt;</span></span></code></pre></div>
<p>Using the settings configured above, an LTI Launch page would contain the following object:</p>
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;fields&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;oauth_consumer_key&#34;</span>: <span style="color:#960050;background-color:#1e0010">&lt;redacted&gt;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;oauth_signature_method&#34;</span>: <span style="color:#e6db74">&#34;HMAC-SHA1&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;oauth_timestamp&#34;</span>: <span style="color:#e6db74">&#34;1769290880&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;oauth_nonce&#34;</span>: <span style="color:#e6db74">&#34;URY5gH_jRTpDDTsCH2MXP&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;oauth_version&#34;</span>: <span style="color:#e6db74">&#34;1.0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;context_id&#34;</span>: <span style="color:#e6db74">&#34;contextkey&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;context_label&#34;</span>: <span style="color:#e6db74">&#34;LTI 101&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;context_title&#34;</span>: <span style="color:#e6db74">&#34;LTI Demo Course&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;launch_presentation_document_target&#34;</span>: <span style="color:#e6db74">&#34;iframe&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;launch_presentation_locale&#34;</span>: <span style="color:#e6db74">&#34;en&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;launch_presentation_return_url&#34;</span>: <span style="color:#e6db74">&#34;/provider/1&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;lis_outcome_service_url&#34;</span>: <span style="color:#e6db74">&#34;https://ltidemo.home.russfeld.me/lti/consumer/grade_passback&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;lis_result_sourcedid&#34;</span>: <span style="color:#e6db74">&#34;contextkey:resourcekey:userkey:gradebookkey&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;lis_person_contact_email_primary&#34;</span>: <span style="color:#e6db74">&#34;user@domain.tld&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;lis_person_name_family&#34;</span>: <span style="color:#e6db74">&#34;FamilyName&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;lis_person_name_full&#34;</span>: <span style="color:#e6db74">&#34;GivenName FamilyName&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;lis_person_name_given&#34;</span>: <span style="color:#e6db74">&#34;GivenName&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;lti_message_type&#34;</span>: <span style="color:#e6db74">&#34;basic-lti-launch-request&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;lti_version&#34;</span>: <span style="color:#e6db74">&#34;LTI-1p0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;oauth_callback&#34;</span>: <span style="color:#e6db74">&#34;about:blank&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;resource_link_id&#34;</span>: <span style="color:#e6db74">&#34;resourcekey&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;resource_link_title&#34;</span>: <span style="color:#e6db74">&#34;LTI Demo Resource&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;roles&#34;</span>: <span style="color:#e6db74">&#34;Learner&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;tool_consumer_info_product_family_code&#34;</span>: <span style="color:#e6db74">&#34;lti-toolkit&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;tool_consumer_info_version&#34;</span>: <span style="color:#e6db74">&#34;cloud&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;tool_consumer_instance_contact_email&#34;</span>: <span style="color:#e6db74">&#34;admin@domain.tld&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;tool_consumer_instance_guid&#34;</span>: <span style="color:#e6db74">&#34;deployment-001&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;tool_consumer_instance_name&#34;</span>: <span style="color:#e6db74">&#34;LTI Toolkit Demo&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;user_id&#34;</span>: <span style="color:#e6db74">&#34;userkey&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;oauth_signature&#34;</span>: <span style="color:#960050;background-color:#1e0010">&lt;redacted&gt;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;action&#34;</span>: <span style="color:#e6db74">&#34;https://pl.home.russfeld.me/pl/lti&#34;</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>The resulting page:</p>
<p><a href="#R-image-86067f714d8e69832ccc462eaaffe8ea" class="lightbox-link"><img alt="LTI Launch Page" class="border lazy lightbox figure-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/consumer/images/ltilaunch2.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-86067f714d8e69832ccc462eaaffe8ea"><img alt="LTI Launch Page" class="border lazy lightbox lightbox-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/consumer/images/ltilaunch2.png"></a></p>
<p>Click the button to launch the LTI 1.0 Tool Provider.</p>
<h2 id="handling-grade-passback">Handling Grade Passback</h2>
<p>At any time, the LTI 1.0 Tool Provider may provide updated grade information to our example program. That is received at the <code>grade_passback</code> route in the LTI Consumer Router, and then sent to the <code>postProviderGrade</code> function provided in the toolkit configuration as shown above. For this example program, this is handled in the <code>post-grade</code> handler:</p>
<div class="tab-panel" data-tab-group="c296487628e3a5351ece4b18bb75eaae">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="srcroutespost-gradejs"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('c296487628e3a5351ece4b18bb75eaae','srcroutespost-gradejs')"
    >
      <span class="tab-nav-text">src/routes/post-grade.js</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="srcroutespost-gradejs"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">
<div class="highlight" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * LTI 1.0 Grade Passback Handler for LTI Tool Consumer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {string} providerKey the provider key
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {string} contextKey the context (course) key
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {string} resourceKey the resource (lesson or assignment) key
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {string} userKey the user (student) key
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {string} gradebookKey the gradebook key
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {number} score the score to post (0.0 - 1.0)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {Object} req the Express request object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">postGradeHandler</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">providerKey</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">contextKey</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">resourceKey</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">userKey</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gradebookKey</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">score</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">req</span>,
</span></span><span style="display:flex;"><span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Store grade in the local data store
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">updateLocalDataStoreWithGrade</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">req</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">contextKey</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">resourceKey</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">userKey</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gradebookKey</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">score</span>,
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// No need to return anything; library assumes success here
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}</span></span></code></pre></div>
      </div>
    </div>
  </div>
</div><p>This function is called with a number of helpful parameters:</p>
<ul>
<li><code>providerKey</code> - the shared key for the LTI 1.0 Tool Provider, which can be used to look up the provider in the <code>Provider</code> controller with the <code>getByKey</code> method.</li>
<li><code>contextKey</code> - the unique key for the context (course) in the original LTI launch</li>
<li><code>resourceKey</code> - the unique key for the resource (assignment) in the original LTI launch</li>
<li><code>userKey</code> - the unique key for the user in the original LTI launch</li>
<li><code>gradebookKey</code> - the unique key for the gradebook line item in the original LTI launch</li>
<li><code>score</code> - the grade received, as a floating-point value between 0.0 and 1.0</li>
<li><code>req</code> - the original Express request object</li>
</ul>
<p>This should be enough information to properly record the grade in the LMS gradebook. In this example application, it is just stored in an in-memory object for short-term tracking.</p>
<h2 id="viewing-grades">Viewing Grades</h2>
<p>This example application will display any grades received and stored in local memory in the <code>grades</code> path:</p>
<p><a href="#R-image-ccc12e3ce6126a5c5d5962ad1e0ea3dd" class="lightbox-link"><img alt="LTI Example Grades" class="border lazy lightbox figure-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/consumer/images/ltigrades.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ccc12e3ce6126a5c5d5962ad1e0ea3dd"><img alt="LTI Example Grades" class="border lazy lightbox lightbox-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/consumer/images/ltigrades.png"></a></p>
<p>This matches the grade found in the LTI 1.0 Tool Provider:</p>
<p><a href="#R-image-7e5ed918aa66b2277276214d1d728faa" class="lightbox-link"><img alt="LTI Tool Grades" class="border lazy lightbox figure-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/consumer/images/ltigrades2.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7e5ed918aa66b2277276214d1d728faa"><img alt="LTI Tool Grades" class="border lazy lightbox lightbox-image" loading="lazy" src="/lti-toolkit/00-general/00-examples/consumer/images/ltigrades2.png"></a></p>

  <footer class="footline">
  </footer>
</article>
          </section>
        </div>
      </main>
      
      
      
    </div>
    <script src="/lti-toolkit/js/clipboard/clipboard.min.js?1770144754" defer></script>
    <script src="/lti-toolkit/js/perfect-scrollbar/perfect-scrollbar.min.js?1770144754" defer></script>
    <script src="/lti-toolkit/js/theme.min.js?1770144754" defer></script>
  <script src="/lti-toolkit/js/embed-iframe.min.js?1770144754" defer></script>
  </body>
</html>
